%2章
\chapter{歩行者シミュレーション}

本研究で対象とするエージェントシミュレーションを構成する上で参考とした歩行者シミュレーションと，その考え方の元となっている交通流シミュレーションについて述べる．交通流シミュレーションにおいて導入されている考え方，様々な交通主体が相互作用をしながら系全体として次のアクションを決定していくダイナミズムについてその概要を説明し，次章以降の介護環境を想定した歩行者主体のシミュレーションの示唆を得ることが本章の目的である．また，車椅子など様々なエージェントを構築する上での参考となる混合モデルについても触れることとする．

\section{交通流シミュレーションの分類}

交通流モデルは交通主体の違いによって自動車交通流，歩行者交通流の2種類に大別できるが，これらのモデルはいずれもマクロモデルとミクロモデルに分類可能である．マクロモデルとは交通流を流体や気体などで近似して解析を行うモデルである．一方で，ミクロモデルは自動車や歩行者といった個々の交通主体の挙動を再現し，それら各交通主体の相互作用の結果として交通流を再現するモデルである．マクロモデルを用いたシミュレータは，交通の大まかな流れを把握し，交通渋滞などのマクロな現象を的確に再現することが主な目的といえる．個々の交通主体を見るのではなく，連続体として扱うことによって，一般的にミクロモデルよりも計算負荷を抑えることができる．そのため，広域を対象としたシミュレーションが可能である一方ミクロモデルは交通主体を離散的に扱い，個々の交通挙動を再現していくものである．ミクロモデルの従来の主な目的が交通の局所的な部分を詳細に表現することであったため，広域を対象としたシミュレーションにはあまり用いられてはいなかった．しかしながら近年，計算コストを抑える手法の開発や計算機の発展に伴い，ミクロモデルを広域な領域に適用することのできるシミュレータも増えてきている．自動車交通流のマクロモデルとしては流体モデルが，ミクロモデルとしてはセルオートマトン(cellular automaton，以下CAと略す）モデル，追従モデルが知られている．一方歩行者交通流を表すモデルとしては，流体モデルやCAモデル，追従モデルのほかにパーティクルモデルが知られている．各モデルの違いについては次節以降に説明をする．

\section{歩行者交通流モデル}

2.1節で述べたように，歩行者交通流を表現するためのモデルとしては，マクロモデルとして流体モデルが，ミクロモデルとしてCAモデル，追従モデル，パーティクルモデルが代表的な手法である．本節では，これらのモデルの概要と，その代表的なモデルについて説明する．

\subsection{流体モデル}

歩行者交通流モデルにおける流体モデルは歩行者の流れを巨視的に流体近似するものである．2次元でモデル化されることが多く，例えば，以下のような式が用いられる\cite{continum_theory}．

\begin{equation}
 \frac{\partial k}{\partial t} + \frac{\partial}{\partial x} (\rho u) = 0\\
\end{equation}

\begin{equation}
 q = kV \\
\end{equation}

\begin{equation}
 V = A - B\rho \\
\end{equation}

ただし，$t$時刻，$k$は密度，$x$および$y$は位置$u$および$v$は速度の$x$成分，$y$成分を表す$V$は速度の絶対値であり，$q$は歩行者交通量，$A$および$B$は正の定数である．

\subsection{CAモデル}

歩行者の2次元CAモデルとしては，例えばフロアフィールド（Floor Field，以下FFと略す）モデルが挙げられる\cite{floor_field_model}．このモデルは，離散化された各セルにFFと呼ばれる状態量を設け，自分の周囲のセルのFFを参照して移動方向を決定するモデルであるFFには以下の種類のものがある．\\

\begin{description}
  \item[静的FF]\mbox{}\\
  目的地からの距離
  \item[動的FF]\mbox{}\\
  歩行者が通行したセルに残るフェロモンのような状態量．時間とともに拡散・減衰する．
\end{description}

静的FFによって目的地へ向かおうとする歩行者の行動を動的FFによって，周囲の歩行者の後を追おうとする行動を反映するモデルである．他にも歩行者に視野を持たせ，歩行者そのものの位置や向かう方向を反映させることも可能である．

\subsection{パーティクルモデル}

パーティクルモデルとは，ミクロモデルの中でも，変数を連続的に扱うモデルを指し，歩行者一人一人の挙動を記述し，それらが相互作用を起こすことで生じる交通状況の時間的・空間的な変化を把握するモデルである．一般的に歩行者の挙動は自動車と比較し，自由度が高く，それらをどのように扱うのかに応じていくつかのモデルが存在する．

岡崎らは，1979年に歩行者やその周辺環境について磁荷を持つ物質として扱うことで，歩行者交通流を磁気モデルとして表現した\cite{jiki_model}．各歩行者は正の磁荷を持つ単極子としてモデル化され，以下に挙げる3種類の力を仮想的な力として受けるとした．

\begin{itemize}
 \item 負の磁荷を持つ目的地からの引力
 \item 正の磁荷を持つ壁や柱などの障害物からの斥力
 \item 正の磁荷を 持つ他の歩行者からの斥力
\end{itemize}

そしてこれらの3種類の合力に対して，Newtonの運動方程式を用いることで最終的な加速度を決定している．この磁気モデルに対して，歩行者やその周辺環境の変化によって力の与え方を変化させることを考慮に入れたモデルとして，Helbingらが提唱したSocial Force Model\cite{SFM}が知られている．Social Force Modelでは，他の歩行者と一定の距離を空けようとする人間心理を社会的作用と定義し，これを反発力として加速度決定式に反映している．周囲の歩行者をβ，障害物B，歩行者を引き寄せるものをiとしたとき，歩行者αの加速度は下式に表される4つの仮想的な力の重ね合わせによって示されるとしている．

\begin{equation}
\begin{split}
 F_α(t)=F_α^o(υ_α,υ_α^0e_α)&+\sum_{β}F_αβ(e_α,r_α-r_β)\\
 &+\sum_{B}F_αβ(e_α,r_α-r_B^α)\\
 &+\sum_{i}F_αi(e_α,r_α-r_i,t)
\end{split}
\end{equation}

ただし$υ_α$は歩行者αの速度，$υ_α^0$は，希望歩行速度，$e_α$は希望歩行方向の単位ベクトル，$r$は対象物方向の位置、tは時間を表す．右辺第一項を，希望歩行速度へ向け
た歩行者推進力，右辺第二項を他の歩行者から受ける斥力，右辺第三項を壁や柱などの障害物からの影響による斥力，右辺第四項を集団凝縮力やショッピングのように外部環境に引き寄せられる引力としている．

異なる要因に基づく力の合力によって歩行者の加速度を決定するという点は異なる要因に基づく力の合力によって歩行者の加速度を決定するという点は磁気モデルと同様だが磁気モデルと同様だが，歩行者推進力の存在や，他歩行者と外部環境などの捉え方の点で違いが見られる．

\subsection{1次元追従モデル}

1次元追従モデルは，パーティクルモデルの一種である．自動車は道路上では車線に沿って進むため，1次元モデルで動きを表現する方法が一般的である．一方歩行者は2次元的な動きをするため，1次元モデルで行動を表現することは難しい．しかし再現するシチュエーションによっては，1次元モデルによって歩行者の行動を表したとしてもモデルの再現性をあまり損なわずに済むこともある．

1次元歩行者モデル(One-dimensional Pedestrian Model，以下OPMと略す)\cite{dimension_pedestrian_model}を例に挙げると，このモデルは災害時の避難誘導計画立案を目的として作られており，避難時を想定しているために歩行者が密集していて前方の歩行者に追従する状況を仮定している．これにより，進行方向に平行な力のみを考えるという前提条件のもとモデルが構築されている．この前提条件に従い前述したSocial Force Modelを改変し，歩行者にかかる仮想的な力のうち，歩行者推進力と，同じレーン前方の歩行者からの社会的作用のみを扱うものとしている．$i+1$番目の歩行者は，以下の式に基づく加速度を受ける．

\begin{equation}
 \frac{dv_{i+1}}{dt} = f_{i+1}^{dr}(t) + f_{i+1,i}^{soc}(t)
\end{equation}

ただし，$f_{i+1}^{dr}(t)$は時刻$t$における希望歩行速度へ向けた推進力，$f_{i+1,i}^{soc}(t)$は前方の歩行者から受ける反発力とする．また，OPMを元にして考えられたモデルが，拡張一次元歩行者モデル(Extended One-dimensional Pedestrian Model．以下ExOPMと略す)\cite{exopm}である．このモデルは，歩道や横断歩道における歩行者の行動を1次元モデルで表現する際に，以下の前提に基づいているとして提案されている．

\begin{enumerate}
   \item 高密度環境では，歩行者は列を形成する
   \item 低密度環境では，列を形成しようが形成しまいが，歩行者交通量に影響を及ぼすほど歩行者の挙動に違いは現れない
\end{enumerate}

OPMでは同一レーン上の直前の歩行者から反発力を受けていたが，ExOPMでは前方N番目の歩行者エージェントから反発力を受けるものとしている．これは自分より遅い歩行者が目の前にいる場合に，N人前の歩行者の位置情報を参照して行動を決めていることとなり，OPMで扱いきれなかった歩行者の追い越し挙動を考慮する意図がある．モデルの加速度決定式は以下のとおりである．

\begin{equation}
 \frac{dv_{i+1}}{dt} = f_{i+1}^{dr}(t) + f_{i+N,i}^{soc}(t)
\end{equation}

歩行者を1次元のモデルで表現することによって，歩行者数が増加するほど計算負荷の高くなりがちな歩行者モデルの短所を補うことが可能である．しかし上記のように，歩行者の行動を1次元モデルで表すには，歩行者の行動が列を形成するような環境であることが制約としてつきまとうことになる．

\section{混合交通モデル}

\subsection{歩車混合モデル}

先述のとおり，既存の交通流シミュレータの多くは自動車か歩行者のみを交通主体として扱ったものが多い．一方で，これらの異なる交通主体が混在することを考慮に入れたシミュレータもいくつか存在する．ただし，従来のモデルでは主に以下の2つを目的としたものが多かった．

\begin{enumerate}
   \item 歩車が混在する空間での相互作用の検証
   \item 歩車の混在が交通流に与える影響
\end{enumerate}

歩車が混在する空間での相互作用の検証は，単一の横断歩道などの局所的な狭い領域において，歩行者と自動車の相互の存在が横断歩道通過時間や交通量にどのような影響を与えるかを検証するものである．三井らの研究\cite{no_signal}やLEEらの研究\cite{ped_model}では，単一の無信号横断歩道における歩行者と自動車の挙動を離散的にモデル化することで，交通量や横断歩道の長さが高齢者の横断に与える影響を表現している．これに対し，羽藤ら\cite{interaction}は歩車共存空間において自動車と歩行者が互いの行動を認知しあうことで，譲歩行動による減速や活動促進による加速を繰り返す挙動をモデル化している．これは2.2行列の利得行列を持つ非協力2人ゲームを用いて，意思決定者の効用関数に他者の選択確率が内生する入れ子型のモデル構造とすることで，歩行者と自動車の相互作用の様子を表現している．これらの研究は一般的に相互作用の影響そのものを検証することが目的であるため，歩行者と自動車の交通流全体への影響は考慮に入れていない．
一方で歩行者の混在が交通流に与える影響を考慮に入れたものとして，\cite{NETSIM}やAVENUE\cite{AVENUE}などの交通流シミュレータが開発されている．微視的交通流シミュレータNETSIMでは，横断歩道上に一定割合で歩行者を発生させることで，それらが自動車に与える影響を評価する事が可能となっている．一方で自動車のモデルとしてハイブリッドブロック密度法と呼ばれる手法を導入し，マクロモデルとミクロモデルの中間的なモデルを採用したシミュレータであるAVENUEでは，歩行者の影響を飽和交通流の低下という形で導入している．これらの例のように，既存の歩車混合シミュレータは歩車の混在によって交通全体へ影響をおよぼしてはいるものの，本質的には自動車交通流のシミュレータであり，歩行者交通流の評価は行わないのが一般的である．このように従来の歩車混合交通流シミュレータは，狭い領域における歩車間の相互作用の影響そのものを検証するシミュレータや，広い領域を扱うものの，自動車交通流の再現性を高める目的で歩行者モデルを導入するシミュレータが多く，広域を対象とした自動車交通流と歩行者交通流の両方を同時に評価するモデルの開発はあまり行われていない．

これに対して著者の所属する研究室で開発をしているMATES(Multi-Agent based Traffic and Environment Simulator)\cite{mates_1}は自動車交通流を主に扱った微視的交通流シミュレータであるが，路面電車モデルや歩行者モデルを導入できるよう拡張することで混合交通流のシミュレーションを行ってきた\cite{mates_2,mates_3,mates_4}．このシミュレータは歩行者交通流が自動車から受ける影響を評価することができるため，自動車および歩行者の交通流を同時に評価することができる．ただし2次元モデルの歩行者モデルを適用している点や，経路探索などによる自律的な経路選択機能を備えていない点を考慮すると，大量の歩行者が発生する状況や広い領域を歩行者が移動する状況のシミュレーションへの適用は，計算負荷の増大や逐一経路を指定しなくてはならないことにより難しくなるといえる．

\subsection{その他の混合交通モデル}

混合交通をモデル化したシミュレーションには，歩行者や自動車以外の交通手段として例えば以下のような交通手段を扱ったものも存在する．

\begin{description}
  \item[乗り合いバス・路面電車]\mbox{}\\
  AIMSUN\cite{dynamic_simulation}は自動車交通流を主に扱った微視的シミュレータであるが，自動車のモデルの一部としてバスモデルや路面電車モデルを導入し，公共交通機関が自動車交通などに与える影響を評価することができる．また，MATESも同様の機能を備えている．
  \item[デマンドバス]\mbox{}\\
  規定された路線を走行し，決められた停留所で乗客を乗降させる通常のバスを乗り合いバスと呼称するのに対し，乗客の要望に応じて走行経路や乗降場所を任意に変更できるバスのことをデマンドバスと呼ぶ．こうしたバスは近年，比較的人口の少ない地方都市などで広がりつつある．
  \item[車椅子]\mbox{}\\
  東京オリンピックが近づいたことで，交通のバリアフリーを意識したものとして車椅子に関するシミュレーションなども行われている．吉田らはパーティクルモデルの一種を用いた群集歩行シミュレータに，外国人や車椅子移動が必要な人々は移動時に制約があるものと考え，歩行者エージェントの一種としてこれらの移動制約者をモデル化することを試みている\cite{escape_simulation}．
  \item[自転車]\mbox{}\\
  自転車は軽車両として法律によって定められているため，本来は車道を通行する必要がある．しかし実際には，自転車を利用する人々は歩道をも頻繁に走行するため歩行者と自転車との相互作用も発生しやすい．大脇らの研究では，SFMを用いて自転車をモデル化することで歩行者と自転車の追い越しやすれ違いなどの相互作用に関するシミュレーションを行い，追い越しやすれ違いによる不快感が道路幅員や交通量によってどのような影響をもたらすか評価している\cite{necessity}．
\end{description}

\section{新たな歩車混合交通流シミュレーション}

本章では既存の交通流モデル，歩行者シミュレーションに触れ，すでに実現している混合交通流シミュレーションの例を紹介した．中でも歩行者シミュレーションに着目すると，人流をマクロ的に記述するモデルや，移動自体の可視化が目的とされたシミュレータの開発が中心であった．一方、MATESを元につくられた歩車混合交通流シミュレータは，自動車交通流と歩行者交通流を同時に評価することが可能であると同時に，個々の主体の特徴を再現することができる．前章でも述べた通り，本研究では介護という現場に着目し、MATESの特徴であるマルチエージェントモデルの考え方のもと，新たなモデルを作成する．
